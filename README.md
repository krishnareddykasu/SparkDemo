# SparkDemo
sqlContext.sql("use app_frdv");
var pre_tab=sqlContext.read.parquet("/hivestage/frdv/frdv/frdmtv/data/prqt/finance_agreement/source_data_loc_cd=TW/product_cd=FX/business_dt=20200731/");
var post_tab=sqlContext.read.parquet("/hivestage/frdv/frdv/frdmtv/data/prqt/finance_agreement_pa/source_data_loc_cd=TW/product_cd=FX/business_dt=20200731/");
pre_tab.registerTempTable("pre_tab");
post_tab.registerTempTable("post_tab");
var final_tab=sqlContext.sql("SELECT CASE WHEN FINAL_VERDICT LIKE '%DIFF_NOTICED%' THEN REGEXP_REPLACE(REGEXP_REPLACE(REGEXP_REPLACE(FINAL_VERDICT,'DIFF_NOTICED',''),'OK',''),'-',',') ELSE 'OK' END AS VERDICT,OUTERQ.* FROM (select A.AGREEMENT_ID AS PREI_AGREEMENT_ID,B.AGREEMENT_ID AS POSTI_AGREEMENT_ID,A.MARKET_VAL AS PRE_MARKET_VAL,B.MARKET_VAL AS POST_MARKET_VAL,CASE WHEN NVL(CAST(A.MARKET_VAL AS DECIMAL(38,6)),'NULL')!=NVL(CAST(B.MARKET_VAL AS DECIMAL(38,6)),'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as MARKET_VAL,A.MARKET_VAL_CURR AS PRE_MARKET_VAL_CURR,B.MARKET_VAL_CURR AS POST_MARKET_VAL_CURR,CASE WHEN NVL(A.MARKET_VAL_CURR,'NULL')!=NVL(B.MARKET_VAL_CURR,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as MARKET_VAL_CURR,A.MTM_AMT AS PRE_MTM_AMT,B.MTM_AMT AS POST_MTM_AMT,CASE WHEN NVL(CAST(A.MTM_AMT AS DECIMAL(38,2)),'NULL')!=NVL(CAST(B.MTM_AMT AS DECIMAL(38,2)),'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as MTM_AMT,A.MTM_CURR AS PRE_MTM_CURR,B.MTM_CURR AS POST_MTM_CURR,CASE WHEN NVL(A.MTM_CURR,'NULL')!=NVL(B.MTM_CURR,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as MTM_CURR,CAST(A.NET_PRESENT_VAL AS DECIMAL(38,6)) AS PRE_NET_PRESENT_VAL,CAST(B.NET_PRESENT_VAL AS DECIMAL(38,6)) AS POST_NET_PRESENT_VAL,CASE WHEN NVL(CAST(A.NET_PRESENT_VAL AS DECIMAL(38,6)),'NULL')!=NVL(CAST(B.NET_PRESENT_VAL AS DECIMAL(38,6)),'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as NET_PRESENT_VAL,A.NET_PRESENT_VAL_CURR_CD AS PRE_NET_PRESENT_VAL_CURR_CD,B.NET_PRESENT_VAL_CURR_CD AS POST_NET_PRESENT_VAL_CURR_CD,CASE WHEN NVL(A.NET_PRESENT_VAL_CURR_CD,'NULL')!=NVL(B.NET_PRESENT_VAL_CURR_CD,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as NET_PRESENT_VAL_CURR_CD,A.OS_PCE AS PRE_OS_PCE,B.OS_PCE AS POST_OS_PCE,CASE WHEN NVL(CAST(A.OS_PCE AS DECIMAL(38,2)),'NULL')!=NVL(CAST(B.OS_PCE AS DECIMAL(38,2)),'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as OS_PCE,A.OS_PCE_CURR_CD AS PRE_OS_PCE_CURR_CD,B.OS_PCE_CURR_CD AS POST_OS_PCE_CURR_CD,CASE WHEN NVL(A.OS_PCE_CURR_CD,'NULL')!=NVL(B.OS_PCE_CURR_CD,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as OS_PCE_CURR_CD,A.OS_PCE_GROSS AS PRE_OS_PCE_GROSS,B.OS_PCE_GROSS AS POST_OS_PCE_GROSS,CASE WHEN NVL(CAST(A.OS_PCE_GROSS AS DECIMAL(38,2)),'NULL')!=NVL(CAST(B.OS_PCE_GROSS AS DECIMAL(38,2)),'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as OS_PCE_GROSS,A.SALES_MARGIN_AMT AS PRE_SALES_MARGIN_AMT,B.SALES_MARGIN_AMT AS POST_SALES_MARGIN_AMT,CASE WHEN NVL(CAST(A.SALES_MARGIN_AMT AS DECIMAL(38,2)),'NULL')!=NVL(CAST(B.SALES_MARGIN_AMT AS DECIMAL(38,2)),'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as SALES_MARGIN_AMT,A.SALES_MARGIN_CURR AS PRE_SALES_MARGIN_CURR,B.SALES_MARGIN_CURR AS POST_SALES_MARGIN_CURR,CASE WHEN NVL(A.SALES_MARGIN_CURR,'NULL')!=NVL(B.SALES_MARGIN_CURR,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as SALES_MARGIN_CURR,A.UPL_AMT AS PRE_UPL_AMT,B.UPL_AMT AS POST_UPL_AMT,CASE WHEN NVL(CAST(A.UPL_AMT AS DECIMAL(38,2)),'NULL')!=NVL(CAST(B.UPL_AMT AS DECIMAL(38,2)),'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as UPL_AMT,A.INTR_ACCRUED_AMT_SOURCE AS PRE_INTR_ACCRUED_AMT_SOURCE,B.INTR_ACCRUED_AMT_SOURCE AS POST_INTR_ACCRUED_AMT_SOURCE,CASE WHEN NVL(CAST(A.INTR_ACCRUED_AMT_SOURCE AS DECIMAL(38,2)),'NULL')!=NVL(CAST(B.INTR_ACCRUED_AMT_SOURCE AS DECIMAL(38,2)),'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as INTR_ACCRUED_AMT_SOURCE,A.GL_CURR_CD AS PRE_GL_CURR_CD,B.GL_CURR_CD AS POST_GL_CURR_CD,CASE WHEN NVL(A.GL_CURR_CD,'NULL')!=NVL(B.GL_CURR_CD,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as GL_CURR_CD,A.LCL_RPRT_CURR_CD AS PRE_LCL_RPRT_CURR_CD,B.LCL_RPRT_CURR_CD AS POST_LCL_RPRT_CURR_CD,CASE WHEN NVL(A.LCL_RPRT_CURR_CD,'NULL')!=NVL(B.LCL_RPRT_CURR_CD,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as LCL_RPRT_CURR_CD,A.PRIN_OS_BAL_IN_LCL_RPRT_CURR AS PRE_PRIN_OS_BAL_IN_LCL_RPRT_CURR,B.PRIN_OS_BAL_IN_LCL_RPRT_CURR AS POST_PRIN_OS_BAL_IN_LCL_RPRT_CURR,CASE WHEN NVL(CAST(A.PRIN_OS_BAL_IN_LCL_RPRT_CURR AS DECIMAL(38,2)),'NULL')!=NVL(CAST(B.PRIN_OS_BAL_IN_LCL_RPRT_CURR AS DECIMAL(38,2)),'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as PRIN_OS_BAL_IN_LCL_RPRT_CURR,A.DEAL_TYPE AS PRE_DEAL_TYPE,B.DEAL_TYPE AS POST_DEAL_TYPE,CASE WHEN NVL(A.DEAL_TYPE,'NULL')!=NVL(B.DEAL_TYPE,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as DEAL_TYPE,A.DELIVERABLE_INDIC AS PRE_DELIVERABLE_INDIC,B.DELIVERABLE_INDIC AS POST_DELIVERABLE_INDIC,CASE WHEN NVL(A.DELIVERABLE_INDIC,'NULL')!=NVL(B.DELIVERABLE_INDIC,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as DELIVERABLE_INDIC,A.FA_LINK_CD AS PRE_FA_LINK_CD,B.FA_LINK_CD AS POST_FA_LINK_CD,CASE WHEN NVL(A.FA_LINK_CD,'NULL')!=NVL(B.FA_LINK_CD,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as FA_LINK_CD,A.INSTRUMENT_CD AS PRE_INSTRUMENT_CD,B.INSTRUMENT_CD AS POST_INSTRUMENT_CD,CASE WHEN NVL(A.INSTRUMENT_CD,'NULL')!=NVL(B.INSTRUMENT_CD,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as INSTRUMENT_CD,A.MUREX_STRATEGY AS PRE_MUREX_STRATEGY,B.MUREX_STRATEGY AS POST_MUREX_STRATEGY,CASE WHEN NVL(A.MUREX_STRATEGY,'NULL')!=NVL(B.MUREX_STRATEGY,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as MUREX_STRATEGY,A.MUREX_TYPOLOGY_CD AS PRE_MUREX_TYPOLOGY_CD,B.MUREX_TYPOLOGY_CD AS POST_MUREX_TYPOLOGY_CD,CASE WHEN NVL(A.MUREX_TYPOLOGY_CD,'NULL')!=NVL(B.MUREX_TYPOLOGY_CD,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as MUREX_TYPOLOGY_CD,A.POSITION_INITIAL_VAL AS PRE_POSITION_INITIAL_VAL,B.POSITION_INITIAL_VAL AS POST_POSITION_INITIAL_VAL,CASE WHEN NVL(CAST(A.POSITION_INITIAL_VAL AS DECIMAL(38,2)),'NULL')!=NVL(CAST(B.POSITION_INITIAL_VAL AS DECIMAL(38,2)),'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as POSITION_INITIAL_VAL,A.SPOT_FORWARD_INDIC AS PRE_SPOT_FORWARD_INDIC,B.SPOT_FORWARD_INDIC AS POST_SPOT_FORWARD_INDIC,CASE WHEN NVL(A.SPOT_FORWARD_INDIC,'NULL')!=NVL(B.SPOT_FORWARD_INDIC,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as SPOT_FORWARD_INDIC,A.HEDGE_INDIC AS PRE_HEDGE_INDIC,B.HEDGE_INDIC AS POST_HEDGE_INDIC,CASE WHEN NVL(A.HEDGE_INDIC,'NULL')!=NVL(B.HEDGE_INDIC,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as HEDGE_INDIC,A.LINK_TRADE_METHOD AS PRE_LINK_TRADE_METHOD,B.LINK_TRADE_METHOD AS POST_LINK_TRADE_METHOD,CASE WHEN NVL(A.LINK_TRADE_METHOD,'NULL')!=NVL(B.LINK_TRADE_METHOD,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as LINK_TRADE_METHOD,A.LINKED_TRADE_TYPE AS PRE_LINKED_TRADE_TYPE,B.LINKED_TRADE_TYPE AS POST_LINKED_TRADE_TYPE,CASE WHEN NVL(A.LINKED_TRADE_TYPE,'NULL')!=NVL(B.LINKED_TRADE_TYPE,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as LINKED_TRADE_TYPE,A.ACCOUNT_OPEN_DT AS PRE_ACCOUNT_OPEN_DT,B.ACCOUNT_OPEN_DT AS POST_ACCOUNT_OPEN_DT,CASE WHEN NVL(A.ACCOUNT_OPEN_DT,'NULL')!=NVL(B.ACCOUNT_OPEN_DT,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as ACCOUNT_OPEN_DT,A.ACCOUNT_STATUS AS PRE_ACCOUNT_STATUS,B.ACCOUNT_STATUS AS POST_ACCOUNT_STATUS,CASE WHEN NVL(A.ACCOUNT_STATUS,'NULL')!=NVL(B.ACCOUNT_STATUS,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as ACCOUNT_STATUS,A.ACCOUNT_VAL_DT AS PRE_ACCOUNT_VAL_DT,B.ACCOUNT_VAL_DT AS POST_ACCOUNT_VAL_DT,CASE WHEN NVL(A.ACCOUNT_VAL_DT,'NULL')!=NVL(B.ACCOUNT_VAL_DT,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as ACCOUNT_VAL_DT,A.BANK_BOOK_CD AS PRE_BANK_BOOK_CD,B.BANK_BOOK_CD AS POST_BANK_BOOK_CD,CASE WHEN NVL(A.BANK_BOOK_CD,'NULL')!=NVL(B.BANK_BOOK_CD,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as BANK_BOOK_CD,A.ACCOUNT_RSHIP_MANAGER AS PRE_ACCOUNT_RSHIP_MANAGER,B.ACCOUNT_RSHIP_MANAGER AS POST_ACCOUNT_RSHIP_MANAGER,CASE WHEN NVL(A.ACCOUNT_RSHIP_MANAGER,'NULL')!=NVL(B.ACCOUNT_RSHIP_MANAGER,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as ACCOUNT_RSHIP_MANAGER,A.CALCULATION_DAY_CONVENTION AS PRE_CALCULATION_DAY_CONVENTION,B.CALCULATION_DAY_CONVENTION AS POST_CALCULATION_DAY_CONVENTION,CASE WHEN NVL(A.CALCULATION_DAY_CONVENTION,'NULL')!=NVL(B.CALCULATION_DAY_CONVENTION,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as CALCULATION_DAY_CONVENTION,A.GL_PRODUCT_CD AS PRE_GL_PRODUCT_CD,B.GL_PRODUCT_CD AS POST_GL_PRODUCT_CD,CASE WHEN NVL(A.GL_PRODUCT_CD,'NULL')!=NVL(B.GL_PRODUCT_CD,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as GL_PRODUCT_CD,A.PRIN_GL_NUMBER AS PRE_PRIN_GL_NUMBER,B.PRIN_GL_NUMBER AS POST_PRIN_GL_NUMBER,CASE WHEN NVL(A.PRIN_GL_NUMBER,'NULL')!=NVL(B.PRIN_GL_NUMBER,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as PRIN_GL_NUMBER,A.GL_PROFIT_CENTRE_CD AS PRE_GL_PROFIT_CENTRE_CD,B.GL_PROFIT_CENTRE_CD AS POST_GL_PROFIT_CENTRE_CD,CASE WHEN NVL(A.GL_PROFIT_CENTRE_CD,'NULL')!=NVL(B.GL_PROFIT_CENTRE_CD,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as GL_PROFIT_CENTRE_CD,A.ENTITY_ID AS PRE_ENTITY_ID,B.ENTITY_ID AS POST_ENTITY_ID,CASE WHEN NVL(A.ENTITY_ID,'NULL')!=NVL(B.ENTITY_ID,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as ENTITY_ID,A.BASE_RATE AS PRE_BASE_RATE,B.BASE_RATE AS POST_BASE_RATE,CASE WHEN NVL(CAST(A.BASE_RATE AS DECIMAL(38,2)),'NULL')!=NVL(CAST(B.BASE_RATE AS DECIMAL(38,2)),'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as BASE_RATE,A.ACCOUNT_ONSHORE_OFFSHORE_INDIC AS PRE_ACCOUNT_ONSHORE_OFFSHORE_INDIC,B.ACCOUNT_ONSHORE_OFFSHORE_INDIC AS POST_ACCOUNT_ONSHORE_OFFSHORE_INDIC,CASE WHEN NVL(A.ACCOUNT_ONSHORE_OFFSHORE_INDIC,'NULL')!=NVL(B.ACCOUNT_ONSHORE_OFFSHORE_INDIC,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as ACCOUNT_ONSHORE_OFFSHORE_INDIC,A.PAYMENT_DAY_RULE AS PRE_PAYMENT_DAY_RULE,B.PAYMENT_DAY_RULE AS POST_PAYMENT_DAY_RULE,CASE WHEN NVL(A.PAYMENT_DAY_RULE,'NULL')!=NVL(B.PAYMENT_DAY_RULE,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as PAYMENT_DAY_RULE,A.ADDITIONAL_CONTRACT_REF_1 AS PRE_ADDITIONAL_CONTRACT_REF_1,B.ADDITIONAL_CONTRACT_REF_1 AS POST_ADDITIONAL_CONTRACT_REF_1,CASE WHEN NVL(A.ADDITIONAL_CONTRACT_REF_1,'NULL')!=NVL(B.ADDITIONAL_CONTRACT_REF_1,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as ADDITIONAL_CONTRACT_REF_1,A.ADDITIONAL_CONTRACT_REF_2 AS PRE_ADDITIONAL_CONTRACT_REF_2,B.ADDITIONAL_CONTRACT_REF_2 AS POST_ADDITIONAL_CONTRACT_REF_2,CASE WHEN NVL(A.ADDITIONAL_CONTRACT_REF_2,'NULL')!=NVL(B.ADDITIONAL_CONTRACT_REF_2,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as ADDITIONAL_CONTRACT_REF_2,A.DEAL_RSHIP_TYPE AS PRE_DEAL_RSHIP_TYPE,B.DEAL_RSHIP_TYPE AS POST_DEAL_RSHIP_TYPE,CASE WHEN NVL(A.DEAL_RSHIP_TYPE,'NULL')!=NVL(B.DEAL_RSHIP_TYPE,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as DEAL_RSHIP_TYPE,A.ACCOUNTING_SECTION AS PRE_ACCOUNTING_SECTION,B.ACCOUNTING_SECTION AS POST_ACCOUNTING_SECTION,CASE WHEN NVL(A.ACCOUNTING_SECTION,'NULL')!=NVL(B.ACCOUNTING_SECTION,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as ACCOUNTING_SECTION,A.BALSHEET_TYPE_CD AS PRE_BALSHEET_TYPE_CD,B.BALSHEET_TYPE_CD AS POST_BALSHEET_TYPE_CD,CASE WHEN NVL(A.BALSHEET_TYPE_CD,'NULL')!=NVL(B.BALSHEET_TYPE_CD,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as BALSHEET_TYPE_CD,A.CALENDAR_CD AS PRE_CALENDAR_CD,B.CALENDAR_CD AS POST_CALENDAR_CD,CASE WHEN NVL(A.CALENDAR_CD,'NULL')!=NVL(B.CALENDAR_CD,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as CALENDAR_CD,A.CASHFLOWS_IMPORT_FLAG AS PRE_CASHFLOWS_IMPORT_FLAG,B.CASHFLOWS_IMPORT_FLAG AS POST_CASHFLOWS_IMPORT_FLAG,CASE WHEN NVL(A.CASHFLOWS_IMPORT_FLAG,'NULL')!=NVL(B.CASHFLOWS_IMPORT_FLAG,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as CASHFLOWS_IMPORT_FLAG,A.DEAL_BOOKING_CENTRE AS PRE_DEAL_BOOKING_CENTRE,B.DEAL_BOOKING_CENTRE AS POST_DEAL_BOOKING_CENTRE,CASE WHEN NVL(A.DEAL_BOOKING_CENTRE,'NULL')!=NVL(B.DEAL_BOOKING_CENTRE,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as DEAL_BOOKING_CENTRE,A.DEPOSIT_LINKED_INDIC AS PRE_DEPOSIT_LINKED_INDIC,B.DEPOSIT_LINKED_INDIC AS POST_DEPOSIT_LINKED_INDIC,CASE WHEN NVL(A.DEPOSIT_LINKED_INDIC,'NULL')!=NVL(B.DEPOSIT_LINKED_INDIC,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as DEPOSIT_LINKED_INDIC,A.DERIVED_FUND_USER AS PRE_DERIVED_FUND_USER,B.DERIVED_FUND_USER AS POST_DERIVED_FUND_USER,CASE WHEN NVL(A.DERIVED_FUND_USER,'NULL')!=NVL(B.DERIVED_FUND_USER,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as DERIVED_FUND_USER,A.TRADER_DESK_CD AS PRE_TRADER_DESK_CD,B.TRADER_DESK_CD AS POST_TRADER_DESK_CD,CASE WHEN NVL(A.TRADER_DESK_CD,'NULL')!=NVL(B.TRADER_DESK_CD,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as TRADER_DESK_CD,A.ENTITY_CD AS PRE_ENTITY_CD,B.ENTITY_CD AS POST_ENTITY_CD,CASE WHEN NVL(A.ENTITY_CD,'NULL')!=NVL(B.ENTITY_CD,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as ENTITY_CD,A.EXT_REF_NUMBER AS PRE_EXT_REF_NUMBER,B.EXT_REF_NUMBER AS POST_EXT_REF_NUMBER,CASE WHEN NVL(A.EXT_REF_NUMBER,'NULL')!=NVL(B.EXT_REF_NUMBER,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as EXT_REF_NUMBER,A.LEGAL_ENTITY AS PRE_LEGAL_ENTITY,B.LEGAL_ENTITY AS POST_LEGAL_ENTITY,CASE WHEN NVL(A.LEGAL_ENTITY,'NULL')!=NVL(B.LEGAL_ENTITY,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as LEGAL_ENTITY,A.LEGAL_ENTITY_HYPERION AS PRE_LEGAL_ENTITY_HYPERION,B.LEGAL_ENTITY_HYPERION AS POST_LEGAL_ENTITY_HYPERION,CASE WHEN NVL(A.LEGAL_ENTITY_HYPERION,'NULL')!=NVL(B.LEGAL_ENTITY_HYPERION,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as LEGAL_ENTITY_HYPERION,A.MATURITY_DT AS PRE_MATURITY_DT,B.MATURITY_DT AS POST_MATURITY_DT,CASE WHEN NVL(A.MATURITY_DT,'NULL')!=NVL(B.MATURITY_DT,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as MATURITY_DT,A.SOURCE_PORT_CD AS PRE_SOURCE_PORT_CD,B.SOURCE_PORT_CD AS POST_SOURCE_PORT_CD,CASE WHEN NVL(A.SOURCE_PORT_CD,'NULL')!=NVL(B.SOURCE_PORT_CD,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as SOURCE_PORT_CD,A.PRODUCT_ATTRIBUTE AS PRE_PRODUCT_ATTRIBUTE,B.PRODUCT_ATTRIBUTE AS POST_PRODUCT_ATTRIBUTE,CASE WHEN NVL(A.PRODUCT_ATTRIBUTE,'NULL')!=NVL(B.PRODUCT_ATTRIBUTE,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as PRODUCT_ATTRIBUTE,A.GL_BU_CD AS PRE_GL_BU_CD,B.GL_BU_CD AS POST_GL_BU_CD,CASE WHEN NVL(A.GL_BU_CD,'NULL')!=NVL(B.GL_BU_CD,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as GL_BU_CD,A.LINKED_DEAL_NUMBER AS PRE_LINKED_DEAL_NUMBER,B.LINKED_DEAL_NUMBER AS POST_LINKED_DEAL_NUMBER,CASE WHEN NVL(A.LINKED_DEAL_NUMBER,'NULL')!=NVL(B.LINKED_DEAL_NUMBER,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as LINKED_DEAL_NUMBER,A.INVESTMENT_INTENT AS PRE_INVESTMENT_INTENT,B.INVESTMENT_INTENT AS POST_INVESTMENT_INTENT,CASE WHEN NVL(A.INVESTMENT_INTENT,'NULL')!=NVL(B.INVESTMENT_INTENT,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as INVESTMENT_INTENT,A.MUREX3_TYPOLOGY_CD AS PRE_MUREX3_TYPOLOGY_CD,B.MUREX3_TYPOLOGY_CD AS POST_MUREX3_TYPOLOGY_CD,CASE WHEN NVL(A.MUREX3_TYPOLOGY_CD,'NULL')!=NVL(B.MUREX3_TYPOLOGY_CD,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as MUREX3_TYPOLOGY_CD,A.BROKEN_PERIOD_TYP AS PRE_BROKEN_PERIOD_TYP,B.BROKEN_PERIOD_TYP AS POST_BROKEN_PERIOD_TYP,CASE WHEN NVL(A.BROKEN_PERIOD_TYP,'NULL')!=NVL(B.BROKEN_PERIOD_TYP,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as BROKEN_PERIOD_TYP,A.INT_EXT_INDIC AS PRE_INT_EXT_INDIC,B.INT_EXT_INDIC AS POST_INT_EXT_INDIC,CASE WHEN NVL(A.INT_EXT_INDIC,'NULL')!=NVL(B.INT_EXT_INDIC,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as INT_EXT_INDIC,A.ORIGINAL_TENOR AS PRE_ORIGINAL_TENOR,B.ORIGINAL_TENOR AS POST_ORIGINAL_TENOR,CASE WHEN NVL(A.ORIGINAL_TENOR,'NULL')!=NVL(B.ORIGINAL_TENOR,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as ORIGINAL_TENOR,A.RESIDUAL_TENOR AS PRE_RESIDUAL_TENOR,B.RESIDUAL_TENOR AS POST_RESIDUAL_TENOR,CASE WHEN NVL(A.RESIDUAL_TENOR,'NULL')!=NVL(B.RESIDUAL_TENOR,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as RESIDUAL_TENOR,A.PRODUCT_CODE AS PRE_PRODUCT_CODE,B.PRODUCT_CODE AS POST_PRODUCT_CODE,CASE WHEN NVL(A.PRODUCT_CODE,'NULL')!=NVL(B.PRODUCT_CODE,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as PRODUCT_CODE,A.ULTIMATE_WS_RL_INDIC AS PRE_ULTIMATE_WS_RL_INDIC,B.ULTIMATE_WS_RL_INDIC AS POST_ULTIMATE_WS_RL_INDIC,CASE WHEN NVL(A.ULTIMATE_WS_RL_INDIC,'NULL')!=NVL(B.ULTIMATE_WS_RL_INDIC,'NULL') THEN 'DIFF_NOTICED' ELSE 'OK' END as ULTIMATE_WS_RL_INDIC,CONCAT(CASE WHEN NVL(CAST(A.MARKET_VAL AS DECIMAL(38,6)),'NULL')!=NVL(CAST(B.MARKET_VAL AS DECIMAL(38,6)),'NULL') THEN CONCAT('DIFF_NOTICED-''MARKET_VAL') ELSE 'OK' END ,CASE WHEN NVL(A.MARKET_VAL_CURR,'NULL')!=NVL(B.MARKET_VAL_CURR,'NULL') THEN CONCAT('DIFF_NOTICED-''MARKET_VAL_CURR') ELSE 'OK' END ,CASE WHEN NVL(CAST(A.MTM_AMT AS DECIMAL(38,2)),'NULL')!=NVL(CAST(B.MTM_AMT AS DECIMAL(38,2)),'NULL') THEN CONCAT('DIFF_NOTICED-''MTM_AMT') ELSE 'OK' END ,CASE WHEN NVL(A.MTM_CURR,'NULL')!=NVL(B.MTM_CURR,'NULL') THEN CONCAT('DIFF_NOTICED-''MTM_CURR') ELSE 'OK' END ,CASE WHEN NVL(CAST(A.NET_PRESENT_VAL AS DECIMAL(38,6)),'NULL')!=NVL(CAST(B.NET_PRESENT_VAL AS DECIMAL(38,6)),'NULL') THEN CONCAT('DIFF_NOTICED-''NET_PRESENT_VAL') ELSE 'OK' END ,CASE WHEN NVL(A.NET_PRESENT_VAL_CURR_CD,'NULL')!=NVL(B.NET_PRESENT_VAL_CURR_CD,'NULL') THEN CONCAT('DIFF_NOTICED-''NET_PRESENT_VAL_CURR_CD') ELSE 'OK' END ,CASE WHEN NVL(CAST(A.OS_PCE AS DECIMAL(38,2)),'NULL')!=NVL(CAST(B.OS_PCE AS DECIMAL(38,2)),'NULL') THEN CONCAT('DIFF_NOTICED-''OS_PCE') ELSE 'OK' END ,CASE WHEN NVL(A.OS_PCE_CURR_CD,'NULL')!=NVL(B.OS_PCE_CURR_CD,'NULL') THEN CONCAT('DIFF_NOTICED-''OS_PCE_CURR_CD') ELSE 'OK' END ,CASE WHEN NVL(CAST(A.OS_PCE_GROSS AS DECIMAL(38,2)),'NULL')!=NVL(CAST(B.OS_PCE_GROSS AS DECIMAL(38,2)),'NULL') THEN CONCAT('DIFF_NOTICED-''OS_PCE_GROSS') ELSE 'OK' END ,CASE WHEN NVL(CAST(A.SALES_MARGIN_AMT AS DECIMAL(38,2)),'NULL')!=NVL(CAST(B.SALES_MARGIN_AMT AS DECIMAL(38,2)),'NULL') THEN CONCAT('DIFF_NOTICED-''SALES_MARGIN_AMT') ELSE 'OK' END ,CASE WHEN NVL(A.SALES_MARGIN_CURR,'NULL')!=NVL(B.SALES_MARGIN_CURR,'NULL') THEN CONCAT('DIFF_NOTICED-''SALES_MARGIN_CURR') ELSE 'OK' END ,CASE WHEN NVL(CAST(A.UPL_AMT AS DECIMAL(38,2)),'NULL')!=NVL(CAST(B.UPL_AMT AS DECIMAL(38,2)),'NULL') THEN CONCAT('DIFF_NOTICED-''UPL_AMT') ELSE 'OK' END ,CASE WHEN NVL(CAST(A.INTR_ACCRUED_AMT_SOURCE AS DECIMAL(38,2)),'NULL')!=NVL(CAST(B.INTR_ACCRUED_AMT_SOURCE AS DECIMAL(38,2)),'NULL') THEN CONCAT('DIFF_NOTICED-''INTR_ACCRUED_AMT_SOURCE') ELSE 'OK' END ,CASE WHEN NVL(A.GL_CURR_CD,'NULL')!=NVL(B.GL_CURR_CD,'NULL') THEN CONCAT('DIFF_NOTICED-''GL_CURR_CD') ELSE 'OK' END ,CASE WHEN NVL(A.LCL_RPRT_CURR_CD,'NULL')!=NVL(B.LCL_RPRT_CURR_CD,'NULL') THEN CONCAT('DIFF_NOTICED-''LCL_RPRT_CURR_CD') ELSE 'OK' END ,CASE WHEN NVL(CAST(A.PRIN_OS_BAL_IN_LCL_RPRT_CURR AS DECIMAL(38,2)),'NULL')!=NVL(CAST(B.PRIN_OS_BAL_IN_LCL_RPRT_CURR AS DECIMAL(38,2)),'NULL') THEN CONCAT('DIFF_NOTICED-''PRIN_OS_BAL_IN_LCL_RPRT_CURR') ELSE 'OK' END ,CASE WHEN NVL(A.DEAL_TYPE,'NULL')!=NVL(B.DEAL_TYPE,'NULL') THEN CONCAT('DIFF_NOTICED-''DEAL_TYPE') ELSE 'OK' END ,CASE WHEN NVL(A.DELIVERABLE_INDIC,'NULL')!=NVL(B.DELIVERABLE_INDIC,'NULL') THEN CONCAT('DIFF_NOTICED-''DELIVERABLE_INDIC') ELSE 'OK' END ,CASE WHEN NVL(A.FA_LINK_CD,'NULL')!=NVL(B.FA_LINK_CD,'NULL') THEN CONCAT('DIFF_NOTICED-''FA_LINK_CD') ELSE 'OK' END ,CASE WHEN NVL(A.INSTRUMENT_CD,'NULL')!=NVL(B.INSTRUMENT_CD,'NULL') THEN CONCAT('DIFF_NOTICED-''INSTRUMENT_CD') ELSE 'OK' END ,CASE WHEN NVL(A.MUREX_STRATEGY,'NULL')!=NVL(B.MUREX_STRATEGY,'NULL') THEN CONCAT('DIFF_NOTICED-''MUREX_STRATEGY') ELSE 'OK' END ,CASE WHEN NVL(A.MUREX_TYPOLOGY_CD,'NULL')!=NVL(B.MUREX_TYPOLOGY_CD,'NULL') THEN CONCAT('DIFF_NOTICED-''MUREX_TYPOLOGY_CD') ELSE 'OK' END ,CASE WHEN NVL(CAST(A.POSITION_INITIAL_VAL AS DECIMAL(38,2)),'NULL')!=NVL(CAST(B.POSITION_INITIAL_VAL AS DECIMAL(38,2)),'NULL') THEN CONCAT('DIFF_NOTICED-''POSITION_INITIAL_VAL') ELSE 'OK' END ,CASE WHEN NVL(A.SPOT_FORWARD_INDIC,'NULL')!=NVL(B.SPOT_FORWARD_INDIC,'NULL') THEN CONCAT('DIFF_NOTICED-''SPOT_FORWARD_INDIC') ELSE 'OK' END ,CASE WHEN NVL(A.HEDGE_INDIC,'NULL')!=NVL(B.HEDGE_INDIC,'NULL') THEN CONCAT('DIFF_NOTICED-''HEDGE_INDIC') ELSE 'OK' END ,CASE WHEN NVL(A.LINK_TRADE_METHOD,'NULL')!=NVL(B.LINK_TRADE_METHOD,'NULL') THEN CONCAT('DIFF_NOTICED-''LINK_TRADE_METHOD') ELSE 'OK' END ,CASE WHEN NVL(A.LINKED_TRADE_TYPE,'NULL')!=NVL(B.LINKED_TRADE_TYPE,'NULL') THEN CONCAT('DIFF_NOTICED-''LINKED_TRADE_TYPE') ELSE 'OK' END ,CASE WHEN NVL(A.ACCOUNT_OPEN_DT,'NULL')!=NVL(B.ACCOUNT_OPEN_DT,'NULL') THEN CONCAT('DIFF_NOTICED-''ACCOUNT_OPEN_DT') ELSE 'OK' END ,CASE WHEN NVL(A.ACCOUNT_STATUS,'NULL')!=NVL(B.ACCOUNT_STATUS,'NULL') THEN CONCAT('DIFF_NOTICED-''ACCOUNT_STATUS') ELSE 'OK' END ,CASE WHEN NVL(A.ACCOUNT_VAL_DT,'NULL')!=NVL(B.ACCOUNT_VAL_DT,'NULL') THEN CONCAT('DIFF_NOTICED-''ACCOUNT_VAL_DT') ELSE 'OK' END ,CASE WHEN NVL(A.BANK_BOOK_CD,'NULL')!=NVL(B.BANK_BOOK_CD,'NULL') THEN CONCAT('DIFF_NOTICED-''BANK_BOOK_CD') ELSE 'OK' END ,CASE WHEN NVL(A.ACCOUNT_RSHIP_MANAGER,'NULL')!=NVL(B.ACCOUNT_RSHIP_MANAGER,'NULL') THEN CONCAT('DIFF_NOTICED-''ACCOUNT_RSHIP_MANAGER') ELSE 'OK' END ,CASE WHEN NVL(A.CALCULATION_DAY_CONVENTION,'NULL')!=NVL(B.CALCULATION_DAY_CONVENTION,'NULL') THEN CONCAT('DIFF_NOTICED-''CALCULATION_DAY_CONVENTION') ELSE 'OK' END ,CASE WHEN NVL(A.GL_PRODUCT_CD,'NULL')!=NVL(B.GL_PRODUCT_CD,'NULL') THEN CONCAT('DIFF_NOTICED-''GL_PRODUCT_CD') ELSE 'OK' END ,CASE WHEN NVL(A.PRIN_GL_NUMBER,'NULL')!=NVL(B.PRIN_GL_NUMBER,'NULL') THEN CONCAT('DIFF_NOTICED-''PRIN_GL_NUMBER') ELSE 'OK' END ,CASE WHEN NVL(A.GL_PROFIT_CENTRE_CD,'NULL')!=NVL(B.GL_PROFIT_CENTRE_CD,'NULL') THEN CONCAT('DIFF_NOTICED-''GL_PROFIT_CENTRE_CD') ELSE 'OK' END ,CASE WHEN NVL(A.ENTITY_ID,'NULL')!=NVL(B.ENTITY_ID,'NULL') THEN CONCAT('DIFF_NOTICED-''ENTITY_ID') ELSE 'OK' END ,CASE WHEN NVL(CAST(A.BASE_RATE AS DECIMAL(38,2)),'NULL')!=NVL(CAST(B.BASE_RATE AS DECIMAL(38,2)),'NULL') THEN CONCAT('DIFF_NOTICED-''BASE_RATE') ELSE 'OK' END ,CASE WHEN NVL(A.ACCOUNT_ONSHORE_OFFSHORE_INDIC,'NULL')!=NVL(B.ACCOUNT_ONSHORE_OFFSHORE_INDIC,'NULL') THEN CONCAT('DIFF_NOTICED-''ACCOUNT_ONSHORE_OFFSHORE_INDIC') ELSE 'OK' END ,CASE WHEN NVL(A.PAYMENT_DAY_RULE,'NULL')!=NVL(B.PAYMENT_DAY_RULE,'NULL') THEN CONCAT('DIFF_NOTICED-''PAYMENT_DAY_RULE') ELSE 'OK' END ,CASE WHEN NVL(A.ADDITIONAL_CONTRACT_REF_1,'NULL')!=NVL(B.ADDITIONAL_CONTRACT_REF_1,'NULL') THEN CONCAT('DIFF_NOTICED-''ADDITIONAL_CONTRACT_REF_1') ELSE 'OK' END ,CASE WHEN NVL(A.ADDITIONAL_CONTRACT_REF_2,'NULL')!=NVL(B.ADDITIONAL_CONTRACT_REF_2,'NULL') THEN CONCAT('DIFF_NOTICED-''ADDITIONAL_CONTRACT_REF_2') ELSE 'OK' END ,CASE WHEN NVL(A.DEAL_RSHIP_TYPE,'NULL')!=NVL(B.DEAL_RSHIP_TYPE,'NULL') THEN CONCAT('DIFF_NOTICED-''DEAL_RSHIP_TYPE') ELSE 'OK' END ,CASE WHEN NVL(A.ACCOUNTING_SECTION,'NULL')!=NVL(B.ACCOUNTING_SECTION,'NULL') THEN CONCAT('DIFF_NOTICED-''ACCOUNTING_SECTION') ELSE 'OK' END ,CASE WHEN NVL(A.BALSHEET_TYPE_CD,'NULL')!=NVL(B.BALSHEET_TYPE_CD,'NULL') THEN CONCAT('DIFF_NOTICED-''BALSHEET_TYPE_CD') ELSE 'OK' END ,CASE WHEN NVL(A.CALENDAR_CD,'NULL')!=NVL(B.CALENDAR_CD,'NULL') THEN CONCAT('DIFF_NOTICED-''CALENDAR_CD') ELSE 'OK' END ,CASE WHEN NVL(A.CASHFLOWS_IMPORT_FLAG,'NULL')!=NVL(B.CASHFLOWS_IMPORT_FLAG,'NULL') THEN CONCAT('DIFF_NOTICED-''CASHFLOWS_IMPORT_FLAG') ELSE 'OK' END ,CASE WHEN NVL(A.DEAL_BOOKING_CENTRE,'NULL')!=NVL(B.DEAL_BOOKING_CENTRE,'NULL') THEN CONCAT('DIFF_NOTICED-''DEAL_BOOKING_CENTRE') ELSE 'OK' END ,CASE WHEN NVL(A.DEPOSIT_LINKED_INDIC,'NULL')!=NVL(B.DEPOSIT_LINKED_INDIC,'NULL') THEN CONCAT('DIFF_NOTICED-''DEPOSIT_LINKED_INDIC') ELSE 'OK' END ,CASE WHEN NVL(A.DERIVED_FUND_USER,'NULL')!=NVL(B.DERIVED_FUND_USER,'NULL') THEN CONCAT('DIFF_NOTICED-''DERIVED_FUND_USER') ELSE 'OK' END ,CASE WHEN NVL(A.TRADER_DESK_CD,'NULL')!=NVL(B.TRADER_DESK_CD,'NULL') THEN CONCAT('DIFF_NOTICED-''TRADER_DESK_CD') ELSE 'OK' END ,CASE WHEN NVL(A.ENTITY_CD,'NULL')!=NVL(B.ENTITY_CD,'NULL') THEN CONCAT('DIFF_NOTICED-''ENTITY_CD') ELSE 'OK' END ,CASE WHEN NVL(A.EXT_REF_NUMBER,'NULL')!=NVL(B.EXT_REF_NUMBER,'NULL') THEN CONCAT('DIFF_NOTICED-''EXT_REF_NUMBER') ELSE 'OK' END ,CASE WHEN NVL(A.LEGAL_ENTITY,'NULL')!=NVL(B.LEGAL_ENTITY,'NULL') THEN CONCAT('DIFF_NOTICED-''LEGAL_ENTITY') ELSE 'OK' END ,CASE WHEN NVL(A.LEGAL_ENTITY_HYPERION,'NULL')!=NVL(B.LEGAL_ENTITY_HYPERION,'NULL') THEN CONCAT('DIFF_NOTICED-''LEGAL_ENTITY_HYPERION') ELSE 'OK' END ,CASE WHEN NVL(A.MATURITY_DT,'NULL')!=NVL(B.MATURITY_DT,'NULL') THEN CONCAT('DIFF_NOTICED-''MATURITY_DT') ELSE 'OK' END ,CASE WHEN NVL(A.SOURCE_PORT_CD,'NULL')!=NVL(B.SOURCE_PORT_CD,'NULL') THEN CONCAT('DIFF_NOTICED-''SOURCE_PORT_CD') ELSE 'OK' END ,CASE WHEN NVL(A.PRODUCT_ATTRIBUTE,'NULL')!=NVL(B.PRODUCT_ATTRIBUTE,'NULL') THEN CONCAT('DIFF_NOTICED-''PRODUCT_ATTRIBUTE') ELSE 'OK' END ,CASE WHEN NVL(A.GL_BU_CD,'NULL')!=NVL(B.GL_BU_CD,'NULL') THEN CONCAT('DIFF_NOTICED-''GL_BU_CD') ELSE 'OK' END ,CASE WHEN NVL(A.LINKED_DEAL_NUMBER,'NULL')!=NVL(B.LINKED_DEAL_NUMBER,'NULL') THEN CONCAT('DIFF_NOTICED-''LINKED_DEAL_NUMBER') ELSE 'OK' END ,CASE WHEN NVL(A.INVESTMENT_INTENT,'NULL')!=NVL(B.INVESTMENT_INTENT,'NULL') THEN CONCAT('DIFF_NOTICED-''INVESTMENT_INTENT') ELSE 'OK' END ,CASE WHEN NVL(A.MUREX3_TYPOLOGY_CD,'NULL')!=NVL(B.MUREX3_TYPOLOGY_CD,'NULL') THEN CONCAT('DIFF_NOTICED-''MUREX3_TYPOLOGY_CD') ELSE 'OK' END ,CASE WHEN NVL(A.BROKEN_PERIOD_TYP,'NULL')!=NVL(B.BROKEN_PERIOD_TYP,'NULL') THEN CONCAT('DIFF_NOTICED-''BROKEN_PERIOD_TYP') ELSE 'OK' END ,CASE WHEN NVL(A.INT_EXT_INDIC,'NULL')!=NVL(B.INT_EXT_INDIC,'NULL') THEN CONCAT('DIFF_NOTICED-''INT_EXT_INDIC') ELSE 'OK' END ,CASE WHEN NVL(A.ORIGINAL_TENOR,'NULL')!=NVL(B.ORIGINAL_TENOR,'NULL') THEN CONCAT('DIFF_NOTICED-''ORIGINAL_TENOR') ELSE 'OK' END ,CASE WHEN NVL(A.RESIDUAL_TENOR,'NULL')!=NVL(B.RESIDUAL_TENOR,'NULL') THEN CONCAT('DIFF_NOTICED-''RESIDUAL_TENOR') ELSE 'OK' END ,CASE WHEN NVL(A.PRODUCT_CODE,'NULL')!=NVL(B.PRODUCT_CODE,'NULL') THEN CONCAT('DIFF_NOTICED-''PRODUCT_CODE') ELSE 'OK' END ,CASE WHEN NVL(A.ULTIMATE_WS_RL_INDIC,'NULL')!=NVL(B.ULTIMATE_WS_RL_INDIC,'NULL') THEN CONCAT('DIFF_NOTICED-''ULTIMATE_WS_RL_INDIC') ELSE 'OK' END) AS FINAL_VERDICT  from pre_tab A LEFT JOIN post_tab B ON A.AGREEMENT_ID=B.AGREEMENT_ID ) OUTERQ");
final_tab.registerTempTable("final_tab"); 
pre_tab.count();
post_tab.count();
var final_show=sqlContext.sql("select VERDICT,count(1) from final_tab group by VERDICT");
final_show.show(500,false);

SG, AU,CN,DH,GB,HB,HK,IN,

ID,KR,MO,TW,VN

EQUT,FX,COMM,DERV,BOND,REPO,MML,MMP

